<!DOCTYPE html>
<html>
  <head>
    <title>Device Ready Example</title>

    <script type="text/javascript" charset="utf-8" src="cordova.js"></script>
    <script type="text/javascript" src="xui.js"></script>
    <script type="text/javascript" charset="utf-8">
	uid = '';

	// device APIs are available
	//
	function onDeviceReady() {
	    setUid();
	    loadPage();
	}

	function setUid(){
	    var permanentStorage = window.localStorage;
	    uid = permanentStorage.getItem('UID');
	}

	function loadPage(){
	    x$('window').xhr('http://ec2-107-20-116-48.compute-1.amazonaws.com/cgi-bin/init.cgi?uid=' + uid, 
	    { async: true,
	      callback: function() { 
			    var resp_json = JSON.parse(this.responseText); 

			    if(resp_json.uid){
				var permanentStorage = window.localStorage;
				permanentStorage.setItem('UID', resp_json.uid);
			    }
			    if(resp_json.alert){
				alert(resp_json.alert);
			    }
			    if(resp_json.html){
				x$('#uiddiv').html(resp_json.html);
			    }
			},
	      headers:{ 'Mobile':'true' },
	    });
	}

	// Wait for device API libraries to load
	//
	function onLoad() {
	    document.addEventListener("deviceready", onDeviceReady, false);
	}

    </script>
  </head>
  <body onload="onLoad()">
	<div id="uiddiv" style="width:100%; background-color: #fff"></div>
	SUB-VERSION-58
  </body>
</html>
